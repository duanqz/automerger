<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AutoMerger Flows</title>
    <link rel="stylesheet" href="./css/base.css"/>
    <link rel="stylesheet" href="./css/react-json.css"/>
    <link rel="stylesheet" href="./css/bootstrap.min.css"/>
    <script src="./js/react.js"></script>
    <script src="./js/react-dom.js"></script>
    <script src="./js/jquery-2.2.3.min.js"></script>
    <script src="./js/browser.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script src="./js/diff.js"></script>
</head>
<body>
<h1>AutoMerger Flows Configuration</h1>
<div id="container">
</div>

<script type="text/babel">

    /** 代码仓库中路径选择与读取*/
    const CONFIG_TYPES = [
        'meizu',
        'archermind',
        'intl',
        'meizuapp',
        'odc'
    ];
    var curSelected = 'meizu';

    const PRIVATE_TOKEN = 'L3oQuEDi-C3-bXeJXjrF';
    const PROJECT_ID = 51;
    const BRANCH = 'master';

    /** 获取gitlab接口数据*/
    const URL_GITLAB_BASE = 'http://gitlab.meizu.com/api/v3';
    const URL_GITLAB_FILE = `${URL_GITLAB_BASE}/projects/${PROJECT_ID}/repository/files`;
    const GET_FILE_NAME = '/flows.json';

    /** 编辑框与label文本之间的切换*/
    var editableViews = [];

    var addEditable = function (editable) {
        editableViews.push(editable);
    }

    var closeEditables = function () {
        editableViews.map((editable)=> {
            if (editable && editable.isMounted() && editable.closeEditable) {
                editable.closeEditable();
            }
        });
    }



    /** 批量选择模态对话框的全局绑定
     * 可以批量输入repoName进行批量选择*/
    var selectModalFunc = null;
    $('#selectModalOk').click(()=> {
        let inputCtrl = $('#selectModalContent');
        let inputText = inputCtrl.val().trim();
        if (inputText !== '') {
            var inputArr = inputText.split("\n");
            selectModalFunc && selectModalFunc(inputArr);
            $('#selectModal').modal('hide');
            inputCtrl.val('');
        } else {
            alert('输入不能为空,请重新输入!');
        }
    });



    /** 批量操作模态对话框的全局绑定*/
    var modalType = '';
    var addModalFunc = null;
    var deleteModalFunc = null;
    var modalSelectionChange = null;

    /** 批量操作模态对话框提交事件*/
    $('#myModalCommit').click(()=> {
        let [upstreamCtrl, downstreamCtrl] = [$('#myModalUpStream'), $('#myModalDownStream')];
        let [textUp, textDown] = [upstreamCtrl.val(), downstreamCtrl.val()];
        if (textUp !== '' && textDown !== '') {
            $('#myModal').modal('hide');
            if (modalType === '添加分支') {
                addModalFunc(textUp, textDown);
            } else {
                deleteModalFunc(textUp, textDown);
            }
            upstreamCtrl.val('');
            downstreamCtrl.val('');
        } else {
            alert('输入不能为空,请重新输入!');
        }
    });

    /** 批量操作模态对话框选择改编事件*/
    $('#myModalSelect').change((event)=> {
        modalSelectionChange(event)
    });


    /** 从服务器载入最初始的内容*/
    var originContent = '';
    /** 当前的json字符串*/
    var curContent = '';


    /** Gitlab相关变量*/
    var gitlabCommitFunc = null;
    /** Gitlab提交信息模态框*/
    $('#commitModalOk').click((event)=> {
        event.preventDefault();
        let logCtrl = $('#commitModalLog');
        let log = logCtrl.val();
        if (log !== '') {
            //log不为空,则提交修改
            gitlabCommitFunc(curContent, log);
        } else {
            alert('提交日志不能为空,请重新输入!');
        }
    });

    /**
     * 定义公共操作的MixIn
     */
    var EditableMixIn = {
        getInitialState: function () {
            return ({
                editable: false,
            });
        },
        componentDidMount() {
            addEditable(this);
        },
        closeEditable() {
            this.setState({
                editable: false,
            });
        },
        changeEditable(event) {
            event && event.preventDefault() && event.stopPropagation();
            let editable = this.state.editable;
            closeEditables();
            this.setState({
                editable: !editable,
            });
        },
    };


    /**
     * 定义主页面
     * */
    var MainView = React.createClass({

        getInitialState: function () {
            return {
                loading: true,
                response: null,
                success: false,
            };
        },

        gitlabParams: {
            private_token: PRIVATE_TOKEN,
            ref: BRANCH,
            file_path: `config/${curSelected}${GET_FILE_NAME}`,
        },

        componentDidMount() {
            this.loadData();
        },

        render: function () {
            return (<div>
                <select onChange={this.onFileSelectChange}
                        defaultValue={curSelected}>{
                    CONFIG_TYPES.map((item)=> {
                        return (<option key={item}
                                        value={item}>
                            {item}
                        </option>);
                    })}
                </select>
                <FlowView success={this.state.success}
                          loading={this.state.loading}
                          response={JSON.parse(this.state.response)}/>
            </div>);
        },

        onFileSelectChange: function (event) {
            let value = event.target.value;
            curSelected = value;
            this.gitlabParams.file_path = `config/${value}${GET_FILE_NAME}`;
            this.loadData();
        },

        loadData: function () {
            this.setState({
                response: null,
                loading: true,
                success: false,
            });
            $.getJSON(URL_GITLAB_FILE, this.gitlabParams, (response)=> {
                let content = response.content;
                if (response.encoding && response.encoding === 'base64') {
                    content = window.atob(content);
                }
                originContent = content;
                this.setState({
                    response: content,
                    loading: false,
                    success: true,
                });
            }, (error)=> {
                this.setState({
                    response: null,
                    loading: false,
                    success: false,
                });
            });
        }

    });

    /**
     * 页面顶层布局
     */
    var FlowView = React.createClass({

        getInitialState: function () {
            return {
                changed: false,
            };
        },

        render: function () {
            if (this.props.loading) {
                return <span>Loading...</span>;
            }
            if (this.props.success) {
                let flowObj = this.props.response;
                let showData = [];
                for (let flowList in flowObj) {
                    let flowName = flowObj[flowList];
                    flowName.key = flowList;
                    showData.push(flowName);
                }
                let changed = this.state.changed;
                return (<div>
                    <RepoList data={showData}
                              list={flowObj}
                              changed={changed}
                              onChecked={this.onChecked}
                              onChange={this.refreshList}/>
                </div>);
            } else {
                return <span>Read error!!!</span>;
            }
        },

        onChecked: function () {
            this.setState({});
            closeEditables();
        },

        refreshList: function (data) {
            this.setState({
                changed: true,
            });
        },
    });


    /**
     * 仓库列表布局
     */
    var RepoList = React.createClass({

        componentDidMount() {
            selectModalFunc = this.selectModalFunc;
        },

        render: function () {
            var index = 0;
            return (<div>
                <button onClick={this.onBatchSelectClick}
                        className="btn">批量导入选择
                </button>
                <table className="table table-striped table-condensed table-bordered">
                    {this.props.data.map((data)=> {
                        return (<FlowRepo data={data}
                                          index={index++}
                                          key={data.key}
                                          list={this.props.list}
                                          onChecked={this.props.onChecked}
                                          onChange={this.props.onChange}/>);
                    })}
                    <RepoAdder list={this.props.list}
                               onChange={this.props.onChange}/>
                </table>
                <FloatBar list={this.props.list}
                          data={this.props.data}
                          onChange={this.props.onChange}
                          changed={this.props.changed}/>
            </div>);
        },

        /** 批量导入选中的repo, 参数是需要导入的repo数组*/
        selectModalFunc: function (repoArray) {
            //先重置之前所有选中
            for (let index in this.props.list) {
                let repo = this.props.list[index];
                repo.checked = false;
            }
            //按参数依次选中
            for (let index in repoArray) {
                let key = repoArray[index];
                let repo = this.props.list[key];
                if (repo) {
                    repo.checked = true
                } else {
                    this.props.list[key] = [];
                    this.props.list[key].checked = true;
                }
            }
            this.props.onChecked();
        },

        onBatchSelectClick: function (event) {
            $('#selectModal').modal();
        },

    });

    /**
     * 底部悬浮窗
     */
    var FloatBar = React.createClass({
        render: function () {
            var hasChecked = false;
            for (var key in this.props.data) {
                if (this.props.data[key].checked) {
                    hasChecked = true;
                    break;
                }
            }
            return (<div className="navbar-fixed-bottom"
                         style={{background:'#F5F5F5', paddingTop: 10}}>
                <div style={{marginBottom: 10, float: 'right'}}>
                    <button onClick={this.onUpClick}
                            style={{marginRight: 10, float: 'right'}}
                            className="btn">回到顶部
                    </button>
                    {this.props.changed &&
                    <button onClick={this.onRefresh}
                            style={{marginRight: 10, float: 'right'}}
                            className="btn btn-info">放弃修改
                    </button>}
                    { this.props.changed &&
                    <JsonSaver list={this.props.list}/>}
                    {hasChecked &&
                    <BatchOperation data={this.props.data}
                                    onChange={this.props.onChange}/>}
                </div>
            </div>);
        },

        onUpClick: function () {
            window.scroll(0, 0);
        },

        onRefresh: function () {
            location.reload();
        }
    });

    /**
     * 批量操作
     * */
    var BatchOperation = React.createClass({

        getInitialState(){
            return ({selection: '添加分支'});
        },

        selArray: [],

        componentDidMount() {
            /** 模态对话框是全局的，所以事件只能添加一次*/
            addModalFunc = this.addModalFunc;
            deleteModalFunc = this.deleteModalFunc;
            modalSelectionChange = this.onTypeChange;
        },

        render: function () {
            var total = 0;
            this.selArray = [];
            for (var key in this.props.data) {
                if (this.props.data[key].checked) {
                    this.selArray.push(this.props.data[key]);
                    total++;
                }
            }
            modalType = this.state.selection;
            var titleText = `您将对选中的${total}个仓库进行${modalType}操作`;
            $('#myModalLabel').html(titleText);
            $('#myModalSelect').val(this.state.selection);
            return (<div style={{marginRight: 10, float: 'right'}}>
                <a href="#myModal"
                   role="button"
                   className="btn"
                   data-toggle="modal">操作选中
                </a>
            </div>);
        },

        onTypeChange: function (event) {
            var value = event.target.value;
            if (this.isMounted()) {
                this.setState({selection: value});
            }
        },

        /** 批量添加分支*/
        addModalFunc: function (textUp, textDown) {
            for (var repo in this.selArray) {
                var branch = {
                    downstream: textDown,
                    upstream: textUp,
                };
                this.selArray[repo].push(branch);
            }
            this.props.onChange();
        },

        /** 批量删除分支*/
        deleteModalFunc: function (textUp, textDown) {
            for (var repo in this.selArray) {
                var branchArr = this.selArray[repo];
                for (var branch in branchArr) {
                    var branchObj = branchArr[branch];
                    if (branchObj.upstream === textUp && branchObj.downstream === textDown) {
                        branchArr.splice(branch, 1);
                    }
                }
            }
            this.props.onChange();
        },
    });

    /**
     * 最后保存json按钮
     */
    var JsonSaver = React.createClass({

        componentDidMount() {
            gitlabCommitFunc = this.jsonSaveCommit;
        },

        render: function () {
            return (<div style={{marginRight: 10, float: 'right'}}>
                <button onClick={this.onJsonSave}
                        className="btn btn-primary">提交修改
                </button>
            </div>);
        },

        /** 点击提交按钮*/
        onJsonSave: function (event) {
            event.preventDefault();
            closeEditables();
            //生成json字符串
            curContent = JSON.stringify(this.props.list, null, 2);
            this.judgeModalDialog(curContent);
        },

        /** 判断是否弹出模态对话框**/
        judgeModalDialog: function (curContent) {

            //判断是否有修改,没有修改则不需要提交
            if (curContent === originContent) {
                alert('没有任何修改,无需提交!');
                return
            }

            let gitlabParams = {
                private_token: PRIVATE_TOKEN,
                ref: BRANCH,
                file_path: `config/${curSelected}${GET_FILE_NAME}`,
            }

            $.getJSON(URL_GITLAB_FILE, gitlabParams, (response)=> {
                let content = response.content;
                if (response.encoding && response.encoding === 'base64') {
                    content = window.atob(content);
                }
                //为避免强制覆盖,判断在修改过程中远程文件是否发生变化
                if (content !== originContent) {
                    if (confirm('远程文件已发生改动,是否丢弃修改并载入最新版本?')) {
                        location.reload();
                    }
                    return
                }
                this.showCommitModal(curContent);
            }, (error)=> {
                alert(`网络出错[${error}]`);
            });
        },

        /** 显示模态对话框*/
        showCommitModal: function (curContent) {
            //json与源进行diff计算
            let diff = JsDiff.diffLines(originContent, curContent);
            //获取diff显示区域
            let diffPreview = document.getElementById('diffPreview');
            //清空显示区域
            diffPreview.textContent = '';
            //显示diff内容
            diff.forEach(function (part) {
                let color = part.added ? 'green' :
                        part.removed ? 'red' : 'grey';
                let span = document.createElement('span');
                span.style.color = color;
                span.appendChild(document.createTextNode(part.value));
                diffPreview.appendChild(span);
            });
            //弹出模态对话框
            $('#commitModalFileName').html(`修改的文件: config/${curSelected}${GET_FILE_NAME}`);
            $('#commitModal').modal();
        },

        /** 提交服务器*/
        jsonSaveCommit: function (submitContent, log) {

            let gitlabParams = {
                private_token: PRIVATE_TOKEN,
                ref: BRANCH,
                file_path: `config/${curSelected}${GET_FILE_NAME}`,
            }

            /** 提交前先拉取服务器最新文件来做对比*/
            $.getJSON(URL_GITLAB_FILE, gitlabParams, (response)=> {
                let content = response.content;
                if (response.encoding && response.encoding === 'base64') {
                    content = window.atob(content);
                }
                //为避免冲突,判断在修改过程中远程文件是否发生变化
                if (content !== originContent) {
                    if (confirm('远程文件已发生改动,是否丢弃修改并载入最新版本?')) {
                        location.reload();
                    }
                    return
                }

                this.doAjaxCommit(submitContent, log);
            }, (error)=> {
                alert(`网络出错[${error}]`);
            });
        },

        /** 真正做提交请求*/
        doAjaxCommit: function (content, log) {

            //组建提交参数
            var params = {
                private_token: PRIVATE_TOKEN,
                branch_name: BRANCH,
                file_path: `config/${curSelected}${GET_FILE_NAME}`,
                encoding: 'text',
                content: content,
                commit_message: log,
            };
            //Ajax做PUT提交
            $.ajax({
                type: 'PUT',
                url: URL_GITLAB_FILE,
                data: params,
                success: function (data) {
                    //提交成功后隐藏模态框,刷新页面
                    alert('提交成功了!');
                    let logCtrl = $('#commitModalLog');
                    logCtrl.val('');
                    $('#commitModal').modal('hide');
                    location.reload();
                },
                error: function (msg) {
                    let message = JSON.parse(msg.responseText).message;
                    alert(`提交网络出错[${message}]`);
                }
            });
        }
    });


    /**
     * 添加仓库布局
     */
    var RepoAdder = React.createClass({
        mixins: [EditableMixIn],

        render: function () {
            if (this.state.editable) {
                return (<tbody>
                    <tr>
                        <td colSpan="3">
                            <input type="text"
                                   ref="inputRepoName"
                                   placeholder="RepoName"/>
                        </td>
                        <td>
                            <div className="btn-group">
                                <button className="btn btn-success" onClick={this.onRepoOk}>确定</button>
                                <button className="btn btn-default" onClick={this.changeEditable}>取消</button>
                            </div>
                        </td>
                    </tr>
                </tbody>);
            } else {
                return (<tbody>
                    <tr>
                        <td colSpan="4">
                            <button className="btn btn-default" onClick={this.changeEditable}>添加仓库</button>
                        </td>
                    </tr>
                </tbody>);
            }
        },

        /**
         * 编辑Repo名OK
         * @param event
         */
        onRepoOk: function (event) {
            event.preventDefault();
            var txtRepo = this.refs.inputRepoName.value;
            if (txtRepo) {
                this.props.list[txtRepo] = [];
                this.props.onChange(this.props.list);
                this.changeEditable();
            }
        },
    });


    /**
     * 每个仓库布局
     */
    var FlowRepo = React.createClass({
        mixins: [EditableMixIn],

        render: function () {
            return (<tbody>
                <RepoName data={this.props.data}
                          list={this.props.list}
                          index={this.props.index}
                          onChange={this.props.onChange}
                          onChecked={this.props.onChecked}
                          deleteRepo={this.deleteRepo}/>
                {
                    this.props.data.map((branch, index)=> {
                        return (<BranchName data={this.props.data}
                                            key={this.props.data.key + index}
                                            list={this.props.list}
                                            index={index}
                                            onChange={this.props.onChange}
                                            deleteBranch={this.deleteBranch}
                                            branch={branch}/>);
                    })
                }
                {this.renderBranchAdd()}
            </tbody>);
        },

        /**
         * 添加分支布局
         * @returns {XML}
         */
        renderBranchAdd: function () {
            if (this.state.editable) {
                return (<tr>
                    <td>
                        <input type="text"
                               ref="inputUpstream"
                               placeholder="upstream"/>
                    </td>
                    <td>
                        >>
                    </td>
                    <td>
                        <input type="text"
                               ref="inputDownstream"
                               placeholder="downstream"/>
                    </td>
                    <td>
                        <div className="btn-group">
                            <button className="btn btn-success" onClick={this.onBranchOk}>确定</button>
                            <button className="btn btn-default" onClick={this.changeEditable}>取消</button>
                        </div>
                    </td>
                </tr>);
            } else {
                return (<tr>
                    <td colSpan="5">
                        <button className="btn btn-default" onClick={this.changeEditable}>添加分支</button>
                    </td>
                </tr>);
            }
        },

        /**
         * 修改分支名确定
         */
        onBranchOk: function (event) {
            event.preventDefault();
            var txtUpstream = this.refs.inputUpstream.value;
            var txtDownstream = this.refs.inputDownstream.value;
            if (txtUpstream && txtDownstream) {
                var branch = {
                    downstream: txtDownstream,
                    upstream: txtUpstream,
                };
                this.props.list[this.props.data.key].push(branch);
                this.props.onChange(this.props.list);
                this.setState({
                    editable: false,
                });
            } else {
                return;
            }
        },

        /**
         * 删除分支
         * @param index
         */
        deleteBranch: function (index) {
            var branchList = this.props.list[this.props.data.key];
            var branchItem = branchList[index];
            var c = confirm('确定要删除[' + branchItem.upstream + '>>' + branchItem.downstream + ']？');
            if (c) {
                closeEditables();
                branchList.splice(index, 1);
                this.props.onChange(this.props.list);
            }
        },

        /**
         * 删除仓库
         */
        deleteRepo: function () {
            var repoName = this.props.data.key;
            var c = confirm('确定要删除[' + repoName + ']？');
            if (c) {
                closeEditables();
                delete this.props.list[repoName];
                this.props.onChange(this.props.list);
            }
        },

    });


    /**
     * 每个仓库名布局
     */
    var RepoName = React.createClass({
        mixins: [EditableMixIn],

        render: function () {
            var checked = this.props.data.checked ? true : false;
            if (this.state.editable) {
                return (<tr className="success">
                    <td>
                        <label>{this.props.index + 1}.</label>
                    </td>
                    <td colSpan="2">
                        <input type="text"
                               ref="inputRepoName"
                               defaultValue={this.props.data.key}
                               placeholder="RepoName"/>
                    </td>
                    <td>
                        <div className="btn-group">
                            <button className="btn btn-success" onClick={this.onRepoOk}>确定</button>
                            <button className="btn btn-default" onClick={this.changeEditable}>取消</button>
                        </div>
                    </td>
                </tr>);
            } else {
                return (<tr className="success">
                    <td>
                        <label className="checkbox" onClick={this.onCheckClick}>
                            <input type="checkbox" readOnly
                                   onClick={this.onCheckClick}
                                   checked={checked}
                                   ref="repoCheckbox"/>
                            {this.props.index + 1}
                        </label>
                    </td>
                    <td colSpan="2">
                        <span onClick={this.changeEditable}>{this.props.data.key}</span>
                    </td>
                    <td>
                        <button className="btn btn-danger" onClick={this.deleteRepo}>X</button>
                    </td>
                </tr>);
            }
        },

        /**
         * 当checkbox发生改变时
         */
        onCheckClick: function (event) {
            event.preventDefault();
            var checked = !this.props.data.checked;
            this.props.data.checked = checked;
            this.props.onChecked();
        },

        /**
         * 修改仓库名完成
         * @param event
         */
        onRepoOk: function (event) {
            event.preventDefault();
            var txtRepo = this.refs.inputRepoName.value;
            if (txtRepo === '') {
                return;
            }
            if (txtRepo !== this.props.data.key) {
                this.props.list[txtRepo] = this.props.list[this.props.data.key];
                delete this.props.list[this.props.data.key];
                this.props.onChange(this.props.list);
            }
            this.setState({
                editable: false,
            });
        },

        /**
         * 删除仓库事件
         * @param event
         */
        deleteRepo: function (event) {
            event.preventDefault();
            this.props.deleteRepo();
        }
    });


    /**
     * 每个分支名布局
     */
    var BranchName = React.createClass({
        mixins: [EditableMixIn],

        render: function () {
            if (this.state.editable) {
                return (<tr>
                    <td>
                        <input type="text"
                               defaultValue={this.props.branch.upstream}
                               ref="inputUpstream"
                               placeholder="upstream"/>
                    </td>
                    <td>>></td>
                    <td>
                        <input type="text"
                               defaultValue={this.props.branch.downstream}
                               ref="inputDownstream"
                               placeholder="downstream"/>
                    </td>
                    <td>
                        <div className="btn-group">
                            <button className="btn btn-success" onClick={this.editBranchOk}>确定</button>
                            <button className="btn btn-default" onClick={this.changeEditable}>取消</button>
                        </div>
                    </td>
                </tr>);
            } else {
                return (<tr>
                    <td>
                        <span onClick={this.changeEditable}>{this.props.branch.upstream}</span>
                    </td>
                    <td>>></td>
                    <td>
                        <span onClick={this.changeEditable}>{this.props.branch.downstream}</span>
                    </td>
                    <td>
                        <button className="btn btn-warning" onClick={this.deleteBranch}>X</button>
                    </td>
                </tr>);
            }
        },

        /**
         * 分支名编辑完成
         * @param event
         */
        editBranchOk: function (event) {
            event.preventDefault();
            var txtUpstream = this.refs.inputUpstream.value;
            var txtDownstream = this.refs.inputDownstream.value;
            if (txtUpstream && txtDownstream) {
                var obj = this.props.list[this.props.data.key][this.props.index];
                obj.upstream = txtUpstream;
                obj.downstream = txtDownstream;
                this.props.onChange(this.props.list);
                this.setState({
                    editable: false,
                });
            } else {
                return;
            }
        },

        deleteBranch: function (event) {
            event.preventDefault();
            this.props.deleteBranch(this.props.index);
        }
    });

    var Styles = {
        centerText: {
            textAlign: 'center',
        }
    };

    /**
     * 渲染根节点
     */
    ReactDOM.render(<MainView/>,
            document.getElementById('container')
    );

</script>
<!--批量选择模态框-->
<div>
    <div class="modal fade" id="selectModal" tabindex="-1" role="dialog"
         aria-labelledby="selectModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close"
                            data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="selectModalLabel">
                        批量选择
                    </h4>
                </div>
                <div class="modal-body" style="padding-right:30px">
                    <label></label>
                    <label>输入要批量选择的库,以换行分隔(若不存在,将自动创建)</label>
                    <textarea id="selectModalContent"
                              style="width:100%;resize: none"
                              rows="11"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default"
                            data-dismiss="modal">取消
                    </button>
                    <button type="button" class="btn btn-primary"
                            id="selectModalOk">
                        提交
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!--提交模态框-->
<div>
    <div class="modal fade" id="commitModal" tabindex="-1" role="dialog"
         aria-labelledby="commitModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close"
                            data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="commitModalLabel">
                        提交修改
                    </h4>
                </div>
                <div class="modal-body" style="padding-right:30px">
                    <label id="commitModalFileName"></label>
                    <label>结果预览:</label>
                    <pre id="diffPreview"
                         style="width:100%;resize: none; text-align:left">
                    </pre>
                    <label>提交Log:</label>
                    <textarea id="commitModalLog"
                              style="width:100%;resize: none"
                              rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default"
                            data-dismiss="modal">取消
                    </button>
                    <button type="button" class="btn btn-primary"
                            id="commitModalOk">
                        提交
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!--批量操作模态框-->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close"
                        data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel"></h4>
            </div>
            <div class="modal-body" id="myModalContent">
                <table class="table">
                    <thead>
                    <tr class="active">
                        <td colspan="2"><label>选择批量操作方式</label></td>
                        <td><select class="form-control" id="myModalSelect">
                            <option>添加分支</option>
                            <option>删除分支</option>
                        </select></td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>
                            <input type="text"
                                   id="myModalUpStream"
                                   placeholder="upstream"/>
                        </td>
                        <td>>></td>
                        <td>
                            <input type="text"
                                   id="myModalDownStream"
                                   placeholder="downstream"/>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default"
                        data-dismiss="modal">取消
                </button>
                <button type="button" class="btn btn-primary" id="myModalCommit">
                    确定
                </button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
